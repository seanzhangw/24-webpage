<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game of 24</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>

    <main>
        <nav id="navbar">
            <div style="font-size: 1.5rem; text-align: center;">
                <ul class="nav-links" style="display: flex; justify-content: center; gap: 20px;">
                    <li><a href="#introduction" style="font-size: 1.2rem;">Introduction</a></li>
                    <li><a href="#high-level-design" style="font-size: 1.2rem;">High Level Design</a></li>
                    <li><a href="#software-design" style="font-size: 1.2rem;">Software Design</a></li>
                    <li><a href="#hardware-design" style="font-size: 1.2rem;">Hardware Design</a></li>
                    <li><a href="#results" style="font-size: 1.2rem;">Results</a></li>
                    <li><a href="#conclusions" style="font-size: 1.2rem;">Conclusions</a></li>
                    <li><a href="#appendix" style="font-size: 1.2rem;">Appendix</a></li>
                </ul>
            </div>
        </nav>
        <hr>

        <section id="title" class="section">
            <div class="container">
                <h1>Game of 24</h1>
                <h2>Sean Zhang (swz9), Ray Chang (cc2246), Shizhe Shen
                    (ss4335)<h2>
                        <iframe width="560" height="315"
                            src="https://www.youtube.com/embed/oUg7xzAIQH0?si=7GXE5viiB2rXxfLU"
                            title="YouTube video player" frameborder="0"
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                            referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
                        <figcaption>Demonstration Video</figcaption>
            </div>
        </section>
        <section id=" introduction" class="section">
            <div class="container">
                <h2>Project Introduction</h2>
                <p>Our recreation of the Game of 24 recreates the classic arcade experience with a custom interface that
                    blends nostalgic gameplay with a user-experience focused design.</p>
                <p>The Game of 24 is a classic mathematical puzzle where players must use four given numbers and basic
                    arithmetic operations (+, -, *, /) to form an expression that equals 24. Traditionally the game is
                    played with a deck of cards, where each turn the players will draw four random cards and compete for
                    the fastest speed to calculate to 24. Instead of racing to solve a single round, our implementation
                    tracks the number of collections solved within a configurable time interval.</p>
                <p>The arcade experience is curated with a custom built joystick-based
                    controller, retro-style graphics with the VGA screen, and a persistent leaderboard stored in
                    non-volatile memory. The game is player vs player similar to the
                    versus style arcade games. Difficulty can be adjusted at run-time and a group of 4 numbers of the
                    suitable difficulty are calculated at runtime. Card dealing, flipping animations and sound feedback
                    contribute to the immersive experience.</p>
            </div>
        </section>

        <section id="high-level-design" class="section">
            <div class="container">
                <h2>High Level Design</h2>
                <p>Rationale and sources of your project idea,
                    background math,
                    logical structure,
                    hardware/software tradeoffs,
                    Discuss existing patents, copyrights, and trademarks which are relevant to your project.</p>
                <h3>Rationale Behind Implementing the Game of 24</h3>
                <p>whoever</p>
                <h3>Generating Solutions with a Set Difficulty at Runtime</h3>

                <p>Damian</p>

                <h3>Efficiently Drawing Images to the VGA Screen</h3>
                <p>
                    Images are needed for displaying cards and the 24-logo.
                </p>
                <p>
                    A Python script that converts an image into a 2D C array suitable for VGA
                    rendering. This script uses the Python Imaging Library (PIL) to open the image, resize it according
                    to specified width and height ratios, and then iterates over each pixel. For each pixel, it
                    maps its RGB values to a corresponding 4-bit color value. The resulting 2D array stores
                    these color values, and the
                    script outputs the array in a format directly compatible with C, making it ready for use in VGA
                    rendering.
                </p>
                <p>
                    Initially, we displayed assets on the VGA screen by iterating through each 2D C array, calculating,
                    and
                    setting each pixel individually by setting the upper 4 or lower 4 bits of the
                    <code>vga_data_array</code>.
                    However, this approach proved too slow when sliding or flipping the image.
                </p>
                <p>
                    To optimize, we leveraged the fact that each row of the 2D array is memory-aligned. By using
                    <code>memcpy</code>,
                    we
                    can copy entire rows at once, achieving 32-bit transfersâ€”effectively drawing 8 pixels at a time.
                    This
                    method provides an 8x speed improvement.
                </p>
                <p>
                    Given a desired <code>x</code>, <code>y</code> position and the current row <code>i</code> of the
                    asset we are trying to copy, the index in the <code>vga_data_array</code> to begin copying to is
                    calculated as
                    <code>vga_index = ((y + i) * 640 + x) >> 1</code>. The <code>(y + i) * 640</code> calculates the
                    starting index of the ith row for a 640-pixel wide screen. The addition of <code>x</code> shifts the
                    position from the left edge of the screen to the desired x-coordinate. The right shift by 1
                    operation is required because each byte in the <code>vga_data_array</code> can store two pixels
                    (4-bit color). The right shift by 1 effectively divides the index by 2, converting the pixel index
                    to a byte index.
                </p>
                <h3>Flip Animation</h3>
                <p>
                    The flip animation is based off of the following image. During the first half of the flip, the image
                    will be stretched to a trapezoid shape with the left edge as the longer base and the right edge as
                    the shorter base. The height of the trapezoid will decrease as the flip progress approaches the
                    halfway point. The trapezoid will then be inversed and the right edge will become the longer base
                    and the left edge will become the shorter base. The height of the trapezoid will increase as the
                    flip progresses to the end of the animation.
                </p>
                <!-- NOTE: @Ray, @Damian don't copy this code for other images, it will cut off the top 1/4th of ur image -->
                <div style="display: flex; justify-content: center;">
                    <img src="assets/flip-card.png" alt="Flip Animation" class="flip-animation"
                        style="object-fit: cover; object-position: top; height: 350px; width: auto; clip-path: inset(15% 0 0 0);">
                </div>
                <figcaption>Flip Animation</figcaption>
                <p>
                    The trapezoid is split into the upper right triangle, lower right triangle, and the central
                    rectangle. Parameters such as the height of the left and right bases and the width of the trapezoid,
                    are mapped to values based on the progress of the flip. The top triangle is drawn with the below
                    code. The <code>drawHLineCustom(..)</code> function is based
                    off of the <code>drawHLine(..)</code> function in the VGA library. Instead, it draws a custom asset
                    instead of a solid color. The triangle is drawn starting from the top left of the triangle. As the
                    loop iterates,
                    horizontal lines are drawn from the left edge to the right edge of the triangle. The length of the
                    line drawn is dependent on the <code>accumulator</code> variable. The <code>accumulator</code> is
                    accumulated by <code>triangleStep</code>, which is the
                    the quotient between the trapezoid height and the triangle base. This is effectively the slope of
                    the triangle's hypotenuse. The <code>x_offset</code> addition is used to shift the triangle to the
                    right as the trapezoid's height decreases.
                </p>
                <script src="https://gist.github.com/seanzhangw/832dc650947679014741883355aeac84.js"></script>
                <div style="text-align: center;">
                    <img src="assets/flip_visualized_grid.drawio.png" alt="mac_address"
                        style="max-width: 50%; height: auto;">
                    <figcaption>Drawing Top Triangle and Flip Parameters</figcaption>
                </div>
                <p>
                    The middle rectangle is drawn with the line
                    <code>pasteImage(top_image, image_height, trapezoid_height / 2, x + x_offset, y, bg)</code>.
                    <code>top_image</code> is a pointer to the asset. The <code>image_height</code> is the height of
                    the asset. The <code>x + x_offset</code> and <code>y</code> arguments are the top left x and y
                    coordinates of the image to paste.
                </p>
                <p>
                    The bottom triangle is drawn with similar logic to the top triangle. Since we still draw from the
                    top left of the triangle, the accumulator starts at the full <code>trapezoid_height</code> and
                    decreases.
                </p>
                <script src="https://gist.github.com/seanzhangw/a22cfcbb26e40e85151f638b2ffa4106.js"></script>
                <figcaption>Drawing Bottom Triangle Code</figcaption>

                <p>
                    During the second half of the flip, the same logic largely applies. The right base of the trapezoid
                    grows while the left base shrinks. The trapezoid's height increases instead of decreasing.
                </p>
                <h3>Hardware/Software Tradeoffs</h3>
            </div>
        </section>

        <section id="software-design" class="section">
            <div class="container">
                <h2>Software Design</h2>
                <p>program details. What parts were tricky to write?
                    Be sure to specifically reference any design or code you used from someone else.
                    Things you tried which did not work</p>
            </div>
        </section>

        <section id="hardware-design" class="section">
            <div class="container">
                <h2>Hardware Design</h2>
                <p>Hardware details. Could someone else build this based on what you have written?</p>
                <p>Be sure to specifically reference any design or code you used from someone else.
                    Things you tried which did not work</p>
            </div>
        </section>

        <section id="results" class="section">
            <div class="container">
                <h2>Results</h2>
                <p>Any and all test data, scope traces, waveforms, etc
                    speed of execution (hesitation, filcker, interactiveness, concurrency)
                    accuracy (numeric, music frequencies, video signal timing, etc)
                    how you enforced safety in the design.
                    usability by you and other people</p>
            </div>
        </section>

        <section id="conclusions" class="section">
            <div class="container">
                <h2>Conclusions</h2>
                <p>Analyse your design in terms of how the results met your expectations. What might you do differently
                    next time?
                    How did your design conform to the applicable standards?
                    Intellectual property considerations.
                    Did you reuse code or someone else's design? Did you use any of Altera's IP?
                    Did you use code in the public domain?
                    Are you reverse-engineering a design? How did you deal with patent/trademark issues?
                    Did you have to sign non-disclosure to get a sample part?
                    Are there patent opportunites for your project?</p>
            </div>
        </section>

        <section id="appendix" class="section">
            <div class="container">
                <h2>Appendix</h2>
                <p>appendix</p>
                <p>P2</p>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>&copy; Game of 24</p>
        </div>
    </footer>

    <script>
        // Smooth scrolling for navbar links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();

                const targetId = this.getAttribute('href');
                const targetElement = document.querySelector(targetId);

                window.scrollTo({
                    top: targetElement.offsetTop - 70, // Offset for navbar height
                    behavior: 'smooth'
                });
            });
        });

        // Highlight active section in navbar
        window.addEventListener('scroll', function () {
            const sections = document.querySelectorAll('.section');
            const navLinks = document.querySelectorAll('.nav-links a');

            let currentSection = '';

            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                const sectionHeight = section.clientHeight;

                if (pageYOffset >= sectionTop - 100) {
                    currentSection = section.getAttribute('id');
                }
            });

            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href').substring(1) === currentSection) {
                    link.classList.add('active');
                }
            });
        });
    </script>
</body>

</html>